@model Management_of_Change.ViewModels.ChangeRequestViewModel

<div class="tab-pane fade show @Model.TabActivePccbReview" id="nav-pccbReview" role="tabpanel" aria-labelledby="nav-pccbReview-tab">
    <div class="row my-3">
        <div class="col-6">
            <span>
                <span class="me-2" style="font-size: 1.6rem; font-weight:500; line-height:1.0;">PCCB Meeting(s)</span>
                @if (ViewBag.IsAdmin && Model.ChangeRequest.Change_Status == "PccbReview")
                {
                    @Html.ActionLink("Create New", "Create", "PCCBs", new { id = Model.ChangeRequest.Id, tab = "PccbReview" }, new { @class = "btn btn-success me-1 mb-1" })
                }
                @Html.ActionLink("Back", "Index", "Home", new { }, new { @class = "btn btn-secondary mb-1" })
            </span>
        </div>
        <div class="col-6 text-end">
            <span>
                @if (ViewBag.IsAdmin && ViewBag.ShowCloseoutButton && Model.ChangeRequest.Change_Status == "PccbReview")
                {
                    @Html.ActionLink("Close PCCB Review(s), Advance to Final Approvals", "ClosePccbReview", "ChangeRequests", new { id = Model.ChangeRequest.Id }, new { @class = "btn btn-warning fw-bold mb-1", onclick = "return DisplayProgressMessage(this, 'Processing...');" })
                }
            </span>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <table class="table table-striped table-bordered">
                <thead class="table-primary">
                    <tr>
                        <th>
                            Meeting Date/Time
                        </th>
                        <th>
                            Title
                        </th>
                        <th>
                            Step
                        </th>
                        <th>
                            Agenda
                        </th>
                        <th>
                            Decisions
                        </th>
                        <th>
                            Conditions of Approval
                        </th>
                        <th>
                            Invitees
                        </th>
                        <th>
                            Status
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.ChangeRequest.PccbMeetings)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(modelItem => item.MeetingDateTime)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Title)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Step)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Agenda)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Decisions)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ActionItems)
                            </td>
                            <td>
                                @if (item.Invitees == null)
                                {
                                    <span>0</span>
                                }
                                else
                                {
                                    <span>@item.Invitees.Count()</span>
                                }
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Status)
                            </td>
                            <td class="text-nowrap">
                                @if (ViewBag.IsAdmin)
                                {
                                    if (Model.ChangeRequest.Change_Status != "Closed")
                                    {
                                        <a asp-action="Details" asp-controller="PCCBs" asp-route-id="@item.Id" asp-route-destinationPage="ManageMeeting" class="btn btn-primary me-1">Manage Meeting</a>
                                        <a asp-action="Delete" asp-controller="PCCBs" asp-route-id="@item.Id" class="btn btn-danger me-1">Delete</a>
                                    }
                                    <a asp-action="Details" asp-controller="PCCBs" asp-route-id="@item.Id" class="btn btn-primary me-1">View Meeting</a>
                                }
                                else
                                {
                                    <a asp-action="Details" asp-controller="PCCBs" asp-route-id="@item.Id" class="btn btn-primary me-1">View Meeting</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
                @if (Model.ChangeRequest.PccbMeetings.Count() == 0)
                {
                    <tr>
                        <td class="text-nowrap">No data found</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                }
            </table>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-12 text-end">
            @if (ViewBag.IsAdmin && ViewBag.ShowCloseoutButton && Model.ChangeRequest.Change_Status == "PccbReview")
            {
                @Html.ActionLink("Close PCCB Review(s), Advance to Final Approvals", "ClosePccbReview", "ChangeRequests", new { id = Model.ChangeRequest.Id }, new { @class = "btn btn-warning fw-bold mt-3", onclick = "return DisplayProgressMessage(this, 'Processing...');" })
            }
        </div>
    </div>
</div>