@model Management_of_Change.Models.TaskVM

@{
    ViewData["Title"] = "Details";
}

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
    </symbol>
    <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
    </symbol>
    <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
    </symbol>
</svg>

<h1>Task</h1>
<div>
    <nav class="my-5">
        <ul class="nav nav-tabs" id="nav-tab2" role="tablist">
            <li class="nav-item">
                <a class="nav-link @Model.TabActiveDetail fw-bolder" id="nav-detail-tab2" data-bs-toggle="tab" href="#nav-detail2" role="tab" aria-controls="nav-home" aria-selected="true">Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link @Model.TabActiveAttachments fw-bolder" id="nav-attachments-tab2" data-bs-toggle="tab" href="#nav-attachments2" role="tab" aria-controls="nav-profile" aria-selected="false">Attachments (@Model.Attachments.Count.ToString())</a>
            </li>
        </ul>
    </nav>

    <div class="tab-content" id="nav-tabContent2">
        @******************************************************************************************************************@
        @*  DETAIL TAB ****************************************************************************************************@
        @******************************************************************************************************************@
        <div class="tab-pane fade show @Model.TabActiveDetail" id="nav-detail2" role="tabpanel" aria-labelledby="nav-home-tab">
            <div class="text-nowrap">
                @*<a class="me-2" asp-action="Edit" asp-route-id="@Model?.ChangeRequest?.Id">Edit</a>
                <a class="mx-1" asp-action="Index">Back to List</a>*@
                @if (ViewBag.IsAdmin || ViewBag.Username == Model.Task.AssignedByUser || ViewBag.Username == Model.Task.AssignedToUser)
                {
                    @Html.ActionLink("Edit", "Edit", new { id = @Model.Task.Id, tab = "Details", destinationPage = ViewBag.DestinationPage }, new { @class = "btn btn-primary me-1" })
                }
                @if (ViewBag.DestinationPage == "ChangeRequest")
                {
                    @Html.ActionLink("Back to List", "Details", "ChangeRequests" , new { id = Model.Task.ChangeRequestId, tab = "Tasks" }, new { @class = "btn btn-secondary me-1" })
                }
                else
                {
                    @Html.ActionLink("Back to List", "Index", new { }, new { @class = "btn btn-secondary me-1" })
                }                
                <span class="float-end">
                    @Html.ActionLink("Send Reminder", "TaskReminder", new { id = Model.Task.Id, destinationPage = ViewBag.DestinationPage }, new { @class = "btn btn-info", onclick = "return DisplayProgressMessage(this, 'Sending...');" })
                </span>

            </div>
            <hr />
            <input type="hidden" asp-for="@Model.Task.Id" />
            <input type="hidden" asp-for="@Model.Task.ChangeRequestId" />
            <dl class="row my-3">
                <div class="col-6">
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            MOC#
                        </div>
                        <div class="col-2">
                            @if (Model.Task.MocNumber == null)
                            {

                            }
                            else
                            {
                                @Html.ActionLink(Model.Task.MocNumber, "Details", "ChangeRequests", new { id = Model.Task.ChangeRequestId, tab = "Tasks" }, new { @class = "" })
                                @*@Html.DisplayFor(model => model.MocNumber) || ID: @Html.DisplayFor(model => model.ChangeRequestId)*@
                            }
                        </div>
                        <div class="col-7">
                            @ViewBag.MocTitle
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.Status)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.Status)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.Priority)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.Priority)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.ImplementationType)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.ImplementationType)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.Title)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.Title)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.Description)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.Description)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.AssignedByUser)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.AssignedByUserFullName)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.AssignedToUser)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.AssignedToUserFullName)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.DueDate)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.DueDate)
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.CompletionDate)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.CompletionDate)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.CompletionNotes)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.CompletionNotes)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.OnHoldReason)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.OnHoldReason)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.CancelledReason)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.CancelledReason)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.CreatedUser)
                        </div>
                        <div class="col-9">
                            @ViewBag.CreatedUserDisplayName
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.CreatedDate)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.CreatedDate)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.ModifiedUser)
                        </div>
                        <div class="col-9">
                            @ViewBag.ModifiedUserDisplayName
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.ModifiedDate)
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.ModifiedDate)
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.DeletedUser)
                        </div>
                        <div class="col-9">
                            @ViewBag.DeletedUserDisplayName
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-3 text-end fw-bold">
                            @Html.DisplayNameFor(model => model.Task.DeletedDate)
                            </dt>
                        </div>
                        <div class="col-9">
                            @Html.DisplayFor(model => model.Task.DeletedDate)
                        </div>
                    </div>
                </div>
            </dl>
            <div>
                <hr />
                @*    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
                <a asp-action="Index">Back to List</a>*@
                @if (ViewBag.IsAdmin || ViewBag.Username == Model.Task.AssignedByUser || ViewBag.Username == Model.Task.AssignedToUser)
                {
                    @Html.ActionLink("Edit", "Edit", new { id = @Model.Task.Id, tab = "Details", destinationPage = ViewBag.DestinationPage }, new { @class = "btn btn-primary me-1" })
                }
                @if (ViewBag.DestinationPage == "ChangeRequest")
                {
                    @Html.ActionLink("Back to List", "Details", "ChangeRequests", new { id = Model.Task.ChangeRequestId, tab = "Tasks" }, new { @class = "btn btn-secondary me-1" })
                }
                else
                {
                    @Html.ActionLink("Back to List", "Index", new { }, new { @class = "btn btn-secondary me-1" })
                }
                <span class="float-end">
                    @Html.ActionLink("Send Reminder", "TaskReminder", new { id = Model.Task.Id, destinationPage = ViewBag.DestinationPage }, new { @class = "btn btn-info", onclick = "return DisplayProgressMessage(this, 'Sending...');" })
                </span>
            </div>
        </div>
        @******************************************************************************************************************@
        @*  ATTACHMENTS TAB  **********************************************************************************************@
        @******************************************************************************************************************@
        <div class="tab-pane fade show @Model.TabActiveAttachments" id="nav-attachments2" role="tabpanel" aria-labelledby="nav-attachments-tab">
            <div class="mt-5">
                <span style="font-size: 1.7rem;  font-weight:600; line-height:1.2;">Attachments</span>
                @*     @if (ViewBag.IsAdmin)
                {
                <span>@Html.ActionLink("Add New", "Create", "PccbInvitees", new { pccbId = @Model?.PCCB.Id, tab = "Details" }, new { @class = "btn btn-success align-middle ms-2 mb-2" })</span>
                } *@
                @Html.ActionLink("Back to List", "Index", new { }, new { @class = "btn btn-secondary ms-2 mb-2" })
                @if (ViewBag.PreviousAction != null)
                {
                    <div class="alert alert-success alert-dismissible d-flex align-items-center mt-3" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill" /></svg>
                        <span>
                            <strong>@ViewBag.PreviousAction</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </span>
                    </div>

                    @*         <div class="alert alert-success alert-dismissible fade show" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill" /></svg>
                <strong>MoC Responses have been Saved</strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div> *@
                }
            </div>
            <div class="ms-5">
                <div class="text-nowrap mt-3">
                    @using (Html.BeginForm("SaveFile", "Tasks", new { id = Model.Task.Id }, FormMethod.Post, false, new { enctype = "multipart/form-data" }))
                    {
                        <div class="control-label fw-bold mb-2">
                            <strong>Upload Attachment to Task:</strong>
                        </div>
                        <div class="form-group mb-3">
                            <div class="row">
                                <div class="col-10">
                                    <input type="file" name="fileAttachment" class="form-control" />
                                    <div class="form-group text-danger fw-bold">
                                        @*<input asp-for="FileAttachmentError" class="form-control" />*@
                                        <span asp-validation-for="Attachments" class="text-danger fw-bold mt-1"></span>
                                        @Html.DisplayFor(m => m.FileAttachmentError, new { @class = "fw-bold mt-1" })
                                    </div>
                                </div>
                                <div class="col-2">
                                    @if (ViewBag.IsAdmin)
                                    {
                                        <input type="submit" value="Upload" class="form-control btn btn-success">
                                    }
                                    else
                                    {
                                        <input type="submit" value="Upload" class="form-control btn btn-success disabled">
                                    }

                                </div>
                            </div>
                        </div>
                    }
                </div>
                <table class="table table-bordered table-striped mt-5">
                    <thead class="table-primary">
                        <tr>
                            <th>
                                File Name
                            </th>
                            <th>
                                Date Added
                            </th>
                            <th>
                                Size
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Attachments)
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Name)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.CreatedDate)
                                </td>
                                <td>
                                    @item.Size.ToString("#,##0") bytes
                                    @* @Html.DisplayFor(modelItem => item.Size) *@
                                </td>
                                <td>
                                    @*<a href="@item.FullPath" data-type="URL" target="_blank">View File</a>*@
                                    @*<a asp-controller="ChangeRequests" asp-action="DisplayAttachment" asp-route-id="@item.Id">Edit</a>*@
                                    @Html.ActionLink("Download File", "DownloadFile", "Tasks", new { id = @Model.Task.Id, fileName = item.Name, sourcePath = item.FullPath }, new { @class = "btn btn-secondary", title = "Download to Download Folder" })
                                    @if (ViewBag.IsAdmin)
                                    {
                                        @Html.ActionLink("Delete", "DeleteFile", "Tasks", new { id = @Model.Task.Id, fileName = item.Name, sourcePath = item.FullPath }, new { @class = "btn btn-danger", title = "Delete Attachment" })
                                    }
                                    @*<a asp-controller="ImplementationFinalApprovalResponses" asp-action="Edit" asp-route-id="@item.Id">Edit</a>*@
                                </td>
                            </tr>
                        }
                    </tbody>
                    @if (Model.Attachments == null || Model.Attachments.Count() == 0)
                    {
                        <tr>
                            <td class="text-nowrap">No data found</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    </div>
</div>