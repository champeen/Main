@using EHS.Controllers.ChemicalRiskAssessment
@model IEnumerable<IhChemicalListRow>
@{
    ViewData["Title"] = "IH Chemicals";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">Industrial Hygiene — Chemicals</h1>

    <div class="btn-group">
        <button type="button" class="btn btn-outline-info btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            About Chemical Records
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="https://pubchem.ncbi.nlm.nih.gov/" target="_blank" rel="noopener">PubChem</a></li>
            <li><a class="dropdown-item" href="https://www.cdc.gov/niosh/npg/default.html" target="_blank" rel="noopener">NIOSH Pocket Guide</a></li>
            <li><a class="dropdown-item" href="https://www.osha.gov/chemicaldata" target="_blank" rel="noopener">OSHA Chemical Data</a></li>
        </ul>
    </div>
</div>

<div class="d-flex gap-2 mb-3">
    <a class="btn btn-success btn-sm" asp-controller="IhChemicals" asp-action="Index" title="Add via Fetch/Save">
        <img src="@Url.Content("~/css/icons/lucide/create.svg")" alt="Create" width="24" height="24" />
    </a>
</div>

<style>
    /* Hide the table until DataTables initializes to avoid layout jump */
    .datatable-hidden {
        visibility: hidden;
        height: 0;
    }
</style>

<div class="table-wrapper">
    <div class="table-container datatable-hidden">
        <table id="chemTable" class="table table-striped table-hover table-bordered nowrap" style="width:100%">
            <thead>
                <tr>
                    <th style="width:120px;">Actions</th>
                    <th>CAS Number</th>
                    <th>Preferred Name</th>
                    <th class="text-end">Properties</th>
                    <th class="text-end">Synonyms</th>
                    <th class="text-end">Hazards</th>
                    <th class="text-end">OELs</th>
                    <th class="text-end">Sampling Methods</th>
                    <th class="search-only">__hidden_search_pad__</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model)
                {
                    <tr>
                        <td>
                            <a class="btn btn-secondary btn-sm" asp-action="Details" asp-route-id="@row.Id" title="Details">
                                <img src="@Url.Content("~/css/icons/lucide/details.svg")" alt="Info" width="24" height="24" />
                            </a>
                            <a class="btn btn-danger btn-sm" asp-action="Delete" asp-route-id="@row.Id" title="Delete">
                                <img src="@Url.Content("~/css/icons/lucide/delete.svg")" alt="Delete" width="24" height="24" />
                            </a>
                        </td>
                        <td>@row.CasNumber</td>
                        <td>@(!string.IsNullOrWhiteSpace(row.PreferredName) ? row.PreferredName : "—")</td>
                        <td class="text-end">@row.PropertyCount</td>
                        <td class="text-end">@row.SynonymCount</td>
                        <td class="text-end">@row.HazardCount</td>
                        <td class="text-end">@row.OelCount</td>
                        <td class="text-end">@row.SamplingCount</td>
                        <td>@* hidden searchable text if you want to stuff extra tokens *@</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    @* ---- If your _Layout already includes these, you can remove the CDN block below ----
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" rel="stylesheet" />
    *@

    <script>
                $(function () {
          var table = $('#chemTable')
            .on('init.dt', function () {
              $('.table-container').removeClass('datatable-hidden');
            })
            .DataTable({
              scrollX: true,
              autoWidth: true,
              pageLength: 10,
              lengthChange: true,
              responsive: false,
              order: [[1, 'asc']], // CAS
              dom: "<'table-controls d-flex justify-content-between align-items-center'Bf>t<'d-flex justify-content-between align-items-center mt-2'ip>",
              buttons: [
                { extend: 'copy',  exportOptions: { columns: ':visible:not(:first-child)' } },
                { extend: 'csv',   exportOptions: { columns: ':visible:not(:first-child)' } },
                { extend: 'excel', exportOptions: { columns: ':visible:not(:first-child)' } },
                { extend: 'pdf',   exportOptions: { columns: ':visible:not(:first-child)' } },
                { extend: 'print', exportOptions: { columns: ':visible:not(:first-child)' } }
              ],
              columnDefs: [
                { targets: 0, orderable: false, className: 'no-sort' }, // Actions
                { targets: -1, visible: false, searchable: true }       // Hidden search pad (optional)
              ],
              fixedColumns: { leftColumns: 1 },
              initComplete: function () {
                this.api().columns.adjust();
              }
            });

          // Re-adjust on window resize
          $(window).on('resize', function () { table.columns.adjust(); });
        });
    </script>
}
