@model IEnumerable<EHS.Models.Dropdowns.ChemicalRiskAssessment.risk_eye_contact>
@using System.Linq

@{
    ViewData["Title"] = "Eye Contact Risk List";
    var hasData = Model != null && Model.Any();
}

<div class="container-fluid py-4">
    <div class="card shadow rounded-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="card-title">Eye Contact Risk Dropdowns</h2>
                <div>
                    <a asp-action="Create" class="btn btn-sm btn-success me-2">Create New</a>
                    <a asp-controller="Admin" asp-action="dropdownCRA" class="btn btn-sm btn-outline-secondary">Back</a>
                </div>
            </div>

            <div class="table-wrapper">
                <div class="table-container">
                    <table id="craRiskEyeTable"
                           class="table table-striped table-hover table-bordered nowrap @(hasData ? "datatable-hidden" : "")"
                           style="width:100%">
                        <thead>
                            <tr>
                                <th>@Html.DisplayNameFor(model => model.description)</th>
                                <th>@Html.DisplayNameFor(model => model.sort_order)</th>
                                <th>@Html.DisplayNameFor(model => model.display)</th>
                                <th>@Html.DisplayNameFor(model => model.risk_rating)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (!hasData)
                            {
                                <tr>
                                    <td colspan="5" class="text-center text-muted">
                                        No eye contact risk entries found. Click <strong>Create New</strong> to add one.
                                    </td>
                                </tr>
                            }
                            else
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@Html.DisplayFor(modelItem => item.description)</td>
                                        <td>@Html.DisplayFor(modelItem => item.sort_order)</td>
                                        <td>@Html.DisplayFor(modelItem => item.display)</td>
                                        <td>@Html.DisplayFor(modelItem => item.risk_rating)</td>
                                        <td class="text-nowrap">
                                            <div class="d-flex gap-1 flex-nowrap align-items-center">
                                                <a asp-action="Edit" asp-route-id="@item.id" class="btn btn-sm btn-outline-primary flex-shrink-0">Edit</a>
                                                <a asp-action="Details" asp-route-id="@item.id" class="btn btn-sm btn-outline-info flex-shrink-0">Details</a>
                                                <a asp-action="Delete" asp-route-id="@item.id" class="btn btn-sm btn-outline-danger flex-shrink-0">Delete</a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @* Only initialize DataTables when there is data *@
    @if (hasData)
    {
        <script>
            $(document).ready(function () {
                $('#craRiskEyeTable').DataTable({
                    scrollX: true,
                    autoWidth: false,
                    pageLength: 10,
                    lengthChange: true,
                    responsive: false,
                    order: [],
                    dom: "<'table-controls d-flex justify-content-between align-items-center'Bf>" +
                         "t" +
                         "<'d-flex justify-content-between align-items-center mt-2'ip>",
                    buttons: [
                        { extend: 'copy', exportOptions: { columns: ':visible' } },
                        { extend: 'csv', exportOptions: { columns: ':visible:not(:first-child)' } },
                        { extend: 'excel', exportOptions: { columns: ':visible:not(:first-child)' } },
                        { extend: 'pdf', exportOptions: { columns: ':visible' } },
                        { extend: 'print', exportOptions: { columns: ':visible' } }
                    ],
                    columnDefs: [
                        { targets: [4], orderable: false, className: 'no-sort' } // Actions column
                    ]
                });

                $('#craRiskEyeTable').removeClass('datatable-hidden');
            });
        </script>
    }
}
