@model IEnumerable<EHS.Models.seg_risk_assessment>

@{
    ViewData["Title"] = "Index";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">Similar Exposure Group (SEG) Risk</h1>
    <div class="btn-group">
        <button type="button" class="btn btn-outline-info btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            About SEG Risk
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="https://www.ehs.com/2021/03/ih-101-introduction-to-industrial-hygiene-program-management-part-1-similar-exposure-groups-segs/" target="_blank">SEG Overview (Part 1)</a></li>
            <li><a class="dropdown-item" href="https://www.ehs.com/2021/03/ih-101-part-2-qeas-essential-risk-assessment-methodologies-for-industrial-hygiene-program-management/" target="_blank">Risk Assessment (Part 2)</a></li>
            <li><a class="dropdown-item" href="~/Hierarchy of Controls.png" target="_blank">Industrial Hygiene Hierarchy of Controls</a></li>
        </ul>
    </div>
</div>

<div class="d-flex gap-2 mb-3">
    <a class="btn btn-success btn-sm" asp-action="Create" title="Create">
        <img src="@Url.Content("~/css/icons/lucide/create.svg")" alt="Create" width="24" height="24" />
    </a>
</div>

<div class="table-wrapper">
    <div class="table-container datatable-hidden">
        @* <div class="table-container table-responsive"> *@
        <table id="segTable" class="table table-striped table-hover table-bordered nowrap" style="width:100%">
            <thead>
                <tr>
                    <th></th>
                    <th>
                        @Html.DisplayNameFor(model => model.location)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.role)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.task)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.exposure_type)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.agent)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.oel)
                    </th>
@*                     <th>
                        @Html.DisplayNameFor(model => model.acute_chronic)
                    </th> *@
                    <th>
                        @Html.DisplayNameFor(model => model.route_of_entry)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.frequency_of_task)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.duration_of_task)
                    </th>
@*                     <th>
                        @Html.DisplayNameFor(model => model.monitoring_data_required)
                    </th> *@
                    <th>
                        @Html.DisplayNameFor(model => model.controls_recommended)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.exposure_levels_acceptable)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.assessment_methods_used)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.seg_number_of_workers)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.has_agent_been_changed)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.person_performing_assessment_displayname)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.exposure_rating_description)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.health_effect_rating_description)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.risk_score)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.date_conducted)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.date_reviewed)
                    </th>
                    <th class="search-only">
                        @Html.DisplayNameFor(model => model.additional_notes)
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr @* class="@(
                        item.risk_score >= 12 ? "table-danger" :
                        item.risk_score >= 6 ? "table-warning" :
                        "")" *@>
                    <td>
                        <a class="btn btn-primary btn-sm" asp-action="Edit" asp-route-id="@item.id" title="Edit">
                            <img src="@Url.Content("~/css/icons/lucide/edit.svg")" alt="Edit" width="24" height="24" />
                            @* <i data-lucide="pencil"></i> *@
                        </a>
                        <a class="btn btn-secondary btn-sm" asp-action="Details" asp-route-id="@item.id" title="Details">
                            <img src="@Url.Content("~/css/icons/lucide/details.svg")" alt="Info" width="24" height="24" />
                            @* <i data-lucide="info"></i> *@
                        </a>
                        <a class="btn btn-danger btn-sm" asp-action="Delete" asp-route-id="@item.id" title="Delete">
                            <img src="@Url.Content("~/css/icons/lucide/delete.svg")" alt="Delete" width="24" height="24" />
                            @* <i data-lucide="trash-2"></i> *@
                        </a>
                        <a class="btn btn-info btn-sm" asp-action="Attachments" asp-route-id="@item.id" title="Attachments">
                            <img src="@Url.Content("~/css/icons/lucide/paperclip.svg")" alt="Delete" width="24" height="24" />
                            @* <i data-lucide="trash-2"></i> *@
                        </a>
                        @*                         <a class="btn btn-sm btn-primary" asp-action="Edit" asp-route-id="@item.id">Edit</a>
                        <a class="btn btn-sm btn-secondary" asp-action="Details" asp-route-id="@item.id">Details</a>
                        <a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@item.id">Delete</a> *@
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.location)
                        </td>
                        <td>
                            @* @string.Join(", ", item.seg_role ?? new List<string>()) *@
                            @Html.DisplayFor(modelItem => item.role)
                        </td>
                        <td>
                            @* @string.Join(", ", item.task ?? new List<string>()) *@
                            @Html.DisplayFor(modelItem => item.task)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.exposure_type)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.agent)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.oel)
                        </td>
@*                         <td>
                            @Html.DisplayFor(modelItem => item.acute_chronic)
                        </td> *@
                        <td>
                            @string.Join(", ", item.route_of_entry ?? new List<string>())
                            @* @Html.DisplayFor(modelItem => item.route_of_entry) *@
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.frequency_of_task)
                        </td>
                    @{
                            var ts = item.duration_of_task;
                            var formatted = $"{ts.Days}d {ts.Hours}h {ts.Minutes}m";
                        }
                        <td>
                            <span>@formatted</span>
                            @* @Html.DisplayFor(modelItem => item.duration_of_task) *@
                        </td>
@*                         <td>
                            @Html.DisplayFor(modelItem => item.monitoring_data_required)
                        </td> *@
                        <td>
                            @string.Join(", ", item.controls_recommended ?? new List<string>())
                            @* @Html.DisplayFor(modelItem => item.controls_recommended) *@
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.exposure_levels_acceptable)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.assessment_methods_used)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.seg_number_of_workers)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.has_agent_been_changed)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.person_performing_assessment_displayname)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.exposure_rating_description)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.health_effect_rating_description)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.risk_score)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.date_conducted)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.date_reviewed)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.additional_notes)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
        var table = $('#segTable')
            .on('init.dt', function () {
                $('.table-container').removeClass('datatable-hidden');
            })
            .DataTable({
                scrollX: true,
                autoWidth: false,
                pageLength: 10,
                lengthChange: true,
                responsive: false,
                order: [],
                dom: "<'table-controls d-flex justify-content-between align-items-center'Bf>" +
                    "t" +
                    "<'d-flex justify-content-between align-items-center mt-2'ip>",
                buttons: [
                    {
                        extend: 'copy',
                        exportOptions: { columns: ':visible' }
                    },
                    {
                        extend: 'csv',
                        exportOptions: { columns: ':visible:not(:first-child)' }
                    },
                    {
                        extend: 'excel',
                        exportOptions: { columns: ':visible:not(:first-child)' }
                    },
                    {
                        extend: 'pdf',
                        exportOptions: { columns: ':visible' }
                    },
                    {
                        extend: 'print',
                        exportOptions: { columns: ':visible' }
                    }
                ],
                columnDefs: [
                    { targets: [0], orderable: false, className: 'no-sort' },
                    { targets: -1, visible: false, searchable: true }   // Last column
                ],
                fixedColumns: {
                    leftColumns: 1
                }
            });
        });
    </script>
}